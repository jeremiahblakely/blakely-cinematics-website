<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Gallery Dashboard - Blakely Cinematics</title>
    <style>
        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Refined color palette */
            --header-bg: #0a0a0a;
            --sidebar-bg: #0f0f0f;
            --main-bg: #151515;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-muted: rgba(255, 255, 255, 0.3);
            --primary: #FF6B35;
            --accent-cyan: #00A9E0;
            --star-color: #FFD700;
            --light: #f8f8f8;
            
            /* Layout variables */
            --sidebar-min-left: 180px;
            --sidebar-max-left: 400px;
            --sidebar-min-right: 250px;
            --sidebar-max-right: 500px;
            --header-height: 64px;
            --button-radius: 6px;
            --filmstrip-height: 500px;
        }

        body {
            font-family: 'Helvetica Neue', 'Helvetica', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 200;
            background: var(--header-bg);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* Main Header */
        .main-header {
            height: var(--header-height);
            background: var(--header-bg);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        /* 4-Zone Header Positioning */
        .main-header {
            position: relative !important;
        }
        
        .brand-section {
            position: absolute;
            left: 24px;
            font-size: 1.2rem;
            font-weight: 200;
            letter-spacing: 0.14em;
            text-transform: uppercase;
        }
        
        .vip-accent {
            color: var(--primary);
        }
        
        .client-info-section {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .view-controls-wrapper {
            position: absolute;
            left: 75%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .account-actions {
            position: absolute;
            right: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        @media (max-width: 1024px) {
            .client-info-section {
                display: none;
            }
            .view-controls-wrapper {
                left: 60%;
            }
        }

        .main-header.filmstrip-fullscreen {
            display: none;
        }

        /* Brand and Client Info */
        .brand-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 13px;
            font-weight: 100;
            letter-spacing: 0.14em;
            text-transform: uppercase;
        }

        .logo-blakely {
            color: var(--text-primary);
        }

        .logo-cinematics {
            background: linear-gradient(135deg, var(--light) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-separator {
            width: 1px;
            height: 24px;
            background: var(--border-color);
        }

        .client-info-section {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .client-name {
            font-size: 14px;
            font-weight: 200;
            color: var(--text-primary);
        }

        .gallery-code {
            font-size: 11px;
            font-weight: 200;
            color: var(--text-muted);
            letter-spacing: 0.05em;
        }

        /* Header Controls */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Size Control in Header */
        .header-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .size-icon {
            width: 16px;
            height: 16px;
            opacity: 0.5;
        }

        .header-size-slider {
            width: 100px;
            -webkit-appearance: none;
            appearance: none;
            height: 2px;
            background: var(--border-color);
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .header-size-slider:hover {
            opacity: 1;
        }

        .header-size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 10px;
            height: 10px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
        }

        /* View Toggle Icons */
        .view-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .view-toggle-group {
            display: flex;
            gap: 2px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--button-radius);
            padding: 4px;
        }

        .view-icon-btn {
            width: 32px;
            height: 28px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .view-icon-btn:hover {
            color: var(--text-secondary);
        }

        .view-icon-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Show Names Toggle */
        .show-names-toggle {
            width: 32px;
            height: 28px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: var(--button-radius);
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 11px;
            font-weight: 400;
        }

        .show-names-toggle.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Fullscreen Toggle for Filmstrip */
        .fullscreen-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--border-color);
            border-radius: var(--button-radius);
            color: var(--text-muted);
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 200;
        }

        .fullscreen-toggle.visible {
            display: flex;
        }

        .fullscreen-toggle:hover {
            color: var(--primary);
            border-color: var(--primary);
            background: rgba(0, 0, 0, 0.9);
        }

        .fullscreen-toggle.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Sign Out Button */
        .btn-outline {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 200;
            padding: 8px 20px;
            border: 1px solid var(--border-color);
            border-radius: var(--button-radius);
            background: transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-outline:hover {
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Main Layout Container */
        .dashboard-container {
            position: fixed;
            top: var(--header-height);
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
        }

        .dashboard-container.filmstrip-fullscreen {
            top: 0;
        }

        /* Left Sidebar */
        .left-sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            min-width: var(--sidebar-min-left);
            max-width: var(--sidebar-max-left);
        }

        .left-sidebar.filmstrip-fullscreen {
            display: none;
        }

        .sidebar-header {
            padding: 20px;
            position: relative;
        }

        .sidebar-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-muted);
            font-weight: 200;
        }

        .folder-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 12px 12px;
        }

        .folder-item {
            padding: 12px 16px;
            margin-bottom: 2px;
            cursor: pointer;
            border-radius: var(--button-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 200;
            color: var(--text-secondary);
        }
        
        .folder-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .folder-icon {
            font-size: 14px;
            min-width: 16px;
            text-align: center;
        }
        
        .folder-name {
            flex: 1;
        }

        .folder-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .folder-item.active {
            background: rgba(255, 107, 53, 0.1);
            color: var(--primary);
            border-left: 2px solid var(--primary);
        }

        .folder-count {
            font-size: 11px;
            color: var(--text-muted);
            background: rgba(255, 255, 255, 0.05);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .rename-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s ease;
            padding: 2px;
            filter: grayscale(1);
        }
        
        .folder-item:hover .rename-btn {
            opacity: 1;
        }
        
        .rename-btn:hover {
            transform: scale(1.2);
        }
        
        .trash-btn {
            position: absolute;
            top: 50%;
            right: -40px;
            background: none;
            border: none;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            transform: translateY(-50%);
        }
        
        .trash-btn.visible {
            right: 26px;
            opacity: 1;
        }
        
        .trash-btn:hover {
            transform: translateY(-50%) scale(1.1);
        }
        
        .trash-btn svg {
            width: 16px;
            height: 16px;
            stroke: var(--text-muted);
            transition: stroke 0.2s ease;
        }
        
        .trash-btn:hover svg {
            stroke: #dc3545;
        }
        
        .move-to-trash-btn {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            font-size: 12px;
            padding: 4px;
            color: white;
        }
        
        .gallery-item:hover .move-to-trash-btn,
        .list-item:hover .move-to-trash-btn,
        .filmstrip-item:hover .move-to-trash-btn {
            opacity: 1;
        }
        
        .move-to-trash-btn:hover {
            background: rgba(220, 53, 69, 0.8);
            transform: scale(1.1);
        }
        
        /* Drag and Drop Styles */
        .gallery-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .folder-item.drop-target {
            background: rgba(255, 107, 53, 0.2);
            transform: scale(1.02);
        }
        
        .drag-preview {
            position: fixed;
            top: -1000px;
            left: -1000px;
            pointer-events: none;
            z-index: 1000;
            background: var(--card-bg);
            border: 1px solid var(--primary);
            border-radius: var(--button-radius);
            padding: 4px;
            font-size: 12px;
            color: var(--text-primary);
        }

        /* Updated Resize Handle with Visual Indicator */
        .resize-handle {
            position: absolute;
            top: 0;
            right: -3px;
            bottom: 0;
            width: 6px;
            cursor: col-resize;
            background: transparent;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .resize-handle::before {
            content: '';
            width: 2px;
            height: 40px;
            background: var(--border-color);
            border-radius: 1px;
            transition: all 0.2s ease;
        }

        .resize-handle:hover::before,
        .resize-handle.dragging::before {
            background: var(--primary);
            height: 60px;
        }

        .resize-handle-right {
            left: -3px;
            right: auto;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            background: var(--main-bg);
            overflow-y: auto;
            padding: 24px;
            position: relative;
        }

        /* Gallery Grid View */
        .gallery-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fill, minmax(var(--icon-size, 200px), 1fr));
            transition: all 0.3s ease;
        }

        .gallery-grid.list-view,
        .gallery-grid.filmstrip-view {
            display: none;
        }

        /* Filmstrip View Styles */
        .gallery-filmstrip {
            display: none;
            height: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 20px 0;
            position: relative;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
        }

        .gallery-filmstrip.filmstrip-view {
            display: flex;
        }

        .gallery-filmstrip.fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--main-bg);
            z-index: 1100;
            padding: 40px 0;
        }

        .filmstrip-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1150;
            display: none;
        }

        .gallery-filmstrip.fullscreen .filmstrip-controls {
            display: block;
        }

        .exit-fullscreen-btn {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border: 1px solid var(--border-color);
            border-radius: var(--button-radius);
            cursor: pointer;
            font-size: 13px;
            font-weight: 300;
            transition: all 0.2s ease;
        }

        .exit-fullscreen-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateY(-1px);
        }

        .filmstrip-container {
            display: flex;
            gap: 8px;
            height: 100%;
            align-items: center;
            padding: 0 24px 70px 24px; /* Bottom padding for thumbnail footer */
        }

        .gallery-filmstrip.fullscreen .filmstrip-container {
            padding: 0 60px;
        }

        .filmstrip-item {
            flex-shrink: 0;
            height: calc(100% - 40px);
            max-height: var(--filmstrip-height);
            position: relative;
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--button-radius);
            overflow: hidden;
            transition: transform 0.05s ease-out, opacity 0.05s ease-out, border-color 0.05s ease-out, box-shadow 0.05s ease-out;
            scroll-snap-align: center;
            transform: scale(0.75);
            opacity: 0.4;
            will-change: transform, opacity, border-color, box-shadow;
        }

        .gallery-filmstrip.fullscreen .filmstrip-item {
            max-height: min(80vh, calc(var(--filmstrip-height) * 1.4));
        }

        .filmstrip-item:hover {
            /* Removed hover scaling to avoid conflict with featured scaling */
        }

        .filmstrip-image-container {
            height: 100%;
            position: relative;
        }

        .filmstrip-image {
            height: 100%;
            width: auto;
            object-fit: contain;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .filmstrip-image:hover {
            opacity: 0.9;
        }

        .filmstrip-checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 18px;
            height: 18px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .filmstrip-checkbox:hover {
            border-color: var(--primary);
        }

        .filmstrip-checkbox.checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        .filmstrip-checkbox.checked::after {
            content: '✓';
            color: white;
            font-size: 12px;
        }

        .filmstrip-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
            pointer-events: none;
        }

        .filmstrip-info > * {
            pointer-events: auto;
        }

        .filmstrip-name {
            font-size: 11px;
            color: var(--text-primary);
            margin-bottom: 6px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .filmstrip-name.hidden {
            display: none;
        }

        .filmstrip-rating {
            display: flex;
            gap: 2px;
            justify-content: center;
        }

        /* Gallery Item (Grid) */
        .gallery-item {
            position: relative;
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--button-radius);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 8px 24px rgba(255, 107, 53, 0.1);
        }

        .image-container {
            aspect-ratio: 1;
            overflow: hidden;
            position: relative;
        }

        .gallery-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 18px;
            height: 18px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 2;
        }

        .image-checkbox:hover {
            border-color: var(--primary);
        }

        .image-checkbox.checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        .image-checkbox.checked::after {
            content: '✓';
            color: white;
            font-size: 12px;
        }

        /* Image Info Section */
        .image-info {
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .image-info.hidden {
            padding: 8px;
        }

        .image-name {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .image-name.hidden {
            display: none;
        }

        .rating-stars {
            display: flex;
            gap: 2px;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .star {
            width: 14px;
            height: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            fill: transparent;
            stroke: var(--text-muted);
            z-index: 1;
        }

        .star.filled {
            fill: var(--star-color);
            stroke: var(--star-color);
        }

        .star:hover {
            transform: scale(1.2);
        }

        /* Enhanced List View Table */
        .gallery-list {
            display: none;
            flex-direction: column;
            gap: 0;
            background: var(--card-bg);
            border-radius: var(--button-radius);
            overflow: hidden;
        }

        .gallery-list.list-view {
            display: flex;
        }

        .list-header {
            display: grid;
            grid-template-columns: 40px 80px 2fr 100px 120px 120px 140px 200px;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid var(--border-color);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            font-weight: 400;
        }

        .list-item {
            display: grid;
            grid-template-columns: 40px 80px 2fr 100px 120px 120px 140px 200px;
            align-items: center;
            gap: 16px;
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            transition: all 0.3s ease;
        }

        .list-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .list-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
        }

        .list-checkbox {
            width: 18px;
            height: 18px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            z-index: 2;
        }

        .list-checkbox.checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        .list-checkbox.checked::after {
            content: '✓';
            color: white;
            font-size: 12px;
        }

        .list-filename {
            font-size: 13px;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .list-filename.hidden {
            display: none;
        }

        .list-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .list-rating {
            display: flex;
            gap: 2px;
            justify-content: center;
        }

        .list-notes {
            width: 100%;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 11px;
            color: var(--text-secondary);
            font-family: inherit;
            resize: none;
            transition: all 0.2s ease;
        }

        .list-notes:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.02);
        }

        /* Right Sidebar - Selection Basket */
        .right-sidebar {
            width: 320px;
            background: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            min-width: var(--sidebar-min-right);
            max-width: var(--sidebar-max-right);
        }

        .right-sidebar.filmstrip-fullscreen {
            display: none;
        }

        .basket-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .basket-title {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-muted);
            font-weight: 200;
        }

        .info-toggle {
            width: 20px;
            height: 20px;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            transition: all 0.2s ease;
        }

        .info-toggle:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .info-toggle.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Selection Basket Content */
        .basket-content {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 20px;
        }

        .selection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .basket-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .basket-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .basket-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .basket-item:hover .remove-btn {
            opacity: 1;
        }

        .remove-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Empty Basket State */
        .empty-basket {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
            font-size: 13px;
        }

        /* Details Panel (when toggled) */
        .details-panel {
            display: none;
            flex-direction: column;
            padding: 0 20px 20px;
        }

        .details-panel.active {
            display: flex;
        }

        .detail-section {
            margin-bottom: 16px;
        }

        .detail-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-muted);
            margin-bottom: 6px;
            font-weight: 200;
        }

        .detail-value {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 200;
        }

        /* Centered Finalize Button in Right Sidebar */
        .finalize-selection-fixed {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: 1px solid var(--primary);
            border-radius: var(--button-radius);
            font-size: 13px;
            font-weight: 400;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 100;
            font-family: inherit;
            white-space: nowrap;
        }

        .finalize-selection-fixed:hover {
            background: var(--primary);
            color: white;
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.8), 0 0 60px rgba(255, 107, 53, 0.4);
        }

        .finalize-selection-fixed.filmstrip-fullscreen {
            display: none;
        }
        
        /* Filmstrip Thumbnail Footer */
        .filmstrip-thumbnails {
            position: fixed;
            bottom: 12px; /* Position above scrollbar */
            height: 56px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            border-radius: var(--button-radius);
            display: none;
            align-items: center;
            padding: 6px 12px;
            z-index: 500;
            overflow-x: auto;
            overflow-y: hidden;
            /* Dynamic width will be set by JavaScript */
        }
        
        .filmstrip-view .filmstrip-thumbnails {
            display: flex;
        }
        
        .gallery-filmstrip.fullscreen + .filmstrip-thumbnails,
        .filmstrip-fullscreen .filmstrip-thumbnails {
            display: none;
        }
        
        .thumbnail-container {
            display: flex;
            gap: 6px;
            align-items: center;
            justify-content: center;
            min-width: 100%;
        }
        
        .filmstrip-thumbnail {
            width: 44px;
            height: 44px;
            border-radius: 4px;
            border: 2px solid transparent;
            object-fit: cover;
            cursor: pointer;
            transition: border-color 0.15s ease;
            flex-shrink: 0;
        }
        
        .filmstrip-thumbnail:hover {
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .filmstrip-thumbnail.active {
            border-color: var(--primary);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Basket Counter Badge */
        .basket-count-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
            <!-- Main Header -->
        <!-- Main Header - 4 Zone Layout -->
    <header class="main-header" id="mainHeader">
        <!-- Zone 1: Brand (Left) -->
        <div class="brand-section">
            BLAKELY <span class="vip-accent">VIP</span> <span style="opacity: 0.5;">|</span> DASHBOARD
        </div>
        
        <!-- Zone 2: Client Info (Dead Center @ 50%) -->
        <div class="client-info-section" style="position: absolute; left: 50%; transform: translateX(-50%); text-align: center;">
            <div class="client-name">Demo Client</div>
            <div class="gallery-code">DEMO2025</div>
        </div>
        
        <!-- Zone 3: View Controls (@ 75% position) -->
        <div class="view-controls-wrapper" style="position: absolute; left: 75%; transform: translateX(-50%); display: flex; align-items: center; gap: 16px;">
            <!-- Size Control -->
            <div class="header-size-control">
                <svg class="size-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                </svg>
                <input type="range" class="header-size-slider" id="sizeSlider" min="150" max="400" value="200">
            </div>
            
            <!-- View Toggle -->
            <div class="view-toggle-group">
                <button class="view-icon-btn active" data-view="grid" title="Grid View">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="1" y="1" width="6" height="6"></rect>
                        <rect x="9" y="1" width="6" height="6"></rect>
                        <rect x="1" y="9" width="6" height="6"></rect>
                        <rect x="9" y="9" width="6" height="6"></rect>
                    </svg>
                </button>
                <button class="view-icon-btn" data-view="list" title="List View">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="1" y="2" width="14" height="2"></rect>
                        <rect x="1" y="7" width="14" height="2"></rect>
                        <rect x="1" y="12" width="14" height="2"></rect>
                    </svg>
                </button>
                <button class="view-icon-btn" data-view="filmstrip" title="Filmstrip View">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="0" y="5" width="4" height="6"></rect>
                        <rect x="6" y="5" width="4" height="6"></rect>
                        <rect x="12" y="5" width="4" height="6"></rect>
                    </svg>
                </button>
            </div>
            
            <!-- ABC Toggle -->
            <button class="show-names-toggle" id="showNamesToggle" title="Toggle Filenames">
                ABC
            </button>
        </div>
        
        <!-- Zone 4: Account Actions (Far Right) -->
        <div class="account-actions" style="position: absolute; right: 24px; display: flex; align-items: center; gap: 12px;">
            <!-- Settings Button -->
            <button class="settings-btn" aria-label="Settings" style="width: 32px; height: 32px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; padding: 6px;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <title>Settings</title>
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M1.54 1.54l4.24 4.24M21 12h-6m-6 0H3m13.22 4.22l4.24 4.24M1.54 18.46l4.24-4.24"></path>
                </svg>
            </button>
            
            <!-- Log Out -->
            <a href="#" class="btn-outline" id="logoutBtn">Log Out</a>
        </div>
    </header>



    <!-- Dashboard Container -->
    <div class="dashboard-container" id="dashboardContainer">
        <!-- Left Sidebar -->
        <aside class="left-sidebar" id="leftSidebar">
            <div class="resize-handle" id="leftResizeHandle"></div>
            <div class="sidebar-header">
                <h3 class="sidebar-title">FOLDERS</h3>
                <button class="trash-btn" id="trashBtn" title="Delete Selected Folder">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
            </div>
            <div class="folder-list">
                <div class="folder-item active" data-filter="all">
                    <div class="folder-left">
                        <span class="folder-icon">🖼️</span>
                        <span class="folder-name">All Images</span>
                    </div>
                    <span class="folder-count">24</span>
                </div>
                <div class="folder-item" data-filter="favorites">
                    <div class="folder-left">
                        <span class="folder-icon">❤️</span>
                        <span class="folder-name">Favorites</span>
                    </div>
                    <span class="folder-count">0</span>
                </div>
                <div class="folder-item" data-filter="selected">
                    <div class="folder-left">
                        <span class="folder-icon">✓</span>
                        <span class="folder-name">Selected</span>
                    </div>
                    <span class="folder-count">0</span>
                </div>
                <div class="folder-item" data-filter="rated">
                    <div class="folder-left">
                        <span class="folder-icon">⭐</span>
                        <span class="folder-name">Rated</span>
                    </div>
                    <span class="folder-count">0</span>
                </div>
                <div class="folder-item">
                    <span>+ New Folder</span>
                </div>
            </div>
            
            <!-- Trash folder at bottom -->
            <div style="margin-top: auto; padding: 0 12px 20px;">
                <div class="folder-item" data-filter="trash">
                    <div class="folder-left">
                        <span class="folder-icon">🗑️</span>
                        <span class="folder-name">Trash</span>
                    </div>
                    <span class="folder-count" id="trashCount">0</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Grid View -->
            <div class="gallery-grid" id="galleryGrid">
                <!-- Gallery items will be generated by JavaScript -->
            </div>
            
            <!-- Enhanced List View with Table Header -->
            <div class="gallery-list" id="galleryList">
                <div class="list-header">
                    <div></div>
                    <div>Preview</div>
                    <div>Filename</div>
                    <div>Size</div>
                    <div>Dimensions</div>
                    <div>Date</div>
                    <div>Rating</div>
                    <div>Notes</div>
                </div>
                <div id="listItemsContainer">
                    <!-- List items will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Filmstrip View -->
            <div class="gallery-filmstrip" id="galleryFilmstrip">
                <div class="filmstrip-controls">
                    <button class="exit-fullscreen-btn" onclick="exitFullscreen()">Exit Fullscreen</button>
                </div>
                <div class="filmstrip-container" id="filmstripContainer">
                    <!-- Filmstrip items will be generated by JavaScript -->
                </div>
            </div>
            
            <!-- Fullscreen Toggle Button (Pinned to Main Content) -->
            <button class="fullscreen-toggle" id="fullscreenToggle" title="Fullscreen">
                <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M1 1v5h1V2h4V1H1zm9 0v1h4v4h1V1h-5zM1 10v5h5v-1H2v-4H1zm13 0v4h-4v1h5v-5h-1z"/>
                </svg>
            </button>
        </main>
        
        <!-- Filmstrip Thumbnail Footer -->
        <div class="filmstrip-thumbnails" id="filmstripThumbnails">
            <div class="thumbnail-container" id="thumbnailContainer">
                <!-- Thumbnails will be generated by JavaScript -->
            </div>
        </div>

        <!-- Right Sidebar - Selection Basket -->
        <aside class="right-sidebar" id="rightSidebar">
            <div class="resize-handle resize-handle-right" id="rightResizeHandle"></div>
            <div class="basket-header">
                <h3 class="basket-title">SELECTION BASKET <span class="basket-count-badge" id="basketBadge">0</span></h3>
                <button class="info-toggle" id="infoToggle" title="Toggle Details">ⓘ</button>
            </div>
            
            <!-- Selection Basket View -->
            <div class="basket-content" id="basketContent">
                <div class="selection-grid" id="selectionGrid">
                    <!-- Selected thumbnails will appear here -->
                </div>
                <div class="empty-basket" id="emptyBasket">
                    No images selected yet.<br>
                    Click checkboxes to add images to your selection.
                </div>
            </div>
            
            <!-- Details Panel (Hidden by default) -->
            <div class="details-panel" id="detailsPanel">
                <div class="detail-section">
                    <div class="detail-label">File Name</div>
                    <div class="detail-value" id="detailFileName">—</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Dimensions</div>
                    <div class="detail-value" id="detailDimensions">—</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">File Size</div>
                    <div class="detail-value" id="detailFileSize">—</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Date Taken</div>
                    <div class="detail-value" id="detailDate">—</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Camera</div>
                    <div class="detail-value" id="detailCamera">—</div>
                </div>
            </div>
            
            <!-- Centered Finalize Button -->
            <button class="finalize-selection-fixed" id="finalizeBtn">Finalize Selection</button>
        </aside>
    </div>

    <script>
        // State management
        let selectedImages = new Set();
        let favoriteImages = new Set();
        let currentView = 'grid';
        let currentFilter = 'all';
        let showNames = false;
        let imageData = [];
        let imageNotes = {};
        let customFolders = [];
        let folderContents = {}; // Maps folder IDs to Set of image IDs
        let trashedImages = new Set(); // Images in trash folder

        // Generate mock data
        for (let i = 1; i <= 24; i++) {
            imageData.push({
                id: i,
                url: `https://picsum.photos/400/400?random=${i}`,
                name: `DSC_${String(i).padStart(4, '0')}.jpg`,
                size: '3.2 MB',
                dimensions: '4000 × 2667 px',
                date: `January ${i}, 2025`,
                camera: 'Canon EOS R5',
                rating: 0,
                notes: ''
            });
        }

        // Local storage functions
        function saveState() {
            const state = {
                selectedImages: Array.from(selectedImages),
                favoriteImages: Array.from(favoriteImages),
                customFolders: customFolders,
                folderContents: Object.fromEntries(
                    Object.entries(folderContents).map(([key, value]) => [key, Array.from(value)])
                ),
                imageRatings: imageData.reduce((acc, img) => {
                    if (img.rating > 0) acc[img.id] = img.rating;
                    return acc;
                }, {}),
                imageNotes: imageNotes,
                trashedImages: Array.from(trashedImages)
            };
            localStorage.setItem('vipGalleryState', JSON.stringify(state));
        }
        
        function loadState() {
            const saved = localStorage.getItem('vipGalleryState');
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    
                    // Restore selections
                    selectedImages = new Set(state.selectedImages || []);
                    favoriteImages = new Set(state.favoriteImages || []);
                    
                    // Restore custom folders
                    customFolders = state.customFolders || [];
                    folderContents = Object.fromEntries(
                        Object.entries(state.folderContents || {}).map(([key, value]) => [key, new Set(value)])
                    );
                    
                    // Restore ratings
                    if (state.imageRatings) {
                        Object.entries(state.imageRatings).forEach(([id, rating]) => {
                            const img = imageData.find(i => i.id === parseInt(id));
                            if (img) img.rating = rating;
                        });
                    }
                    
                    // Restore notes
                    imageNotes = state.imageNotes || {};
                    Object.entries(imageNotes).forEach(([id, note]) => {
                        const img = imageData.find(i => i.id === parseInt(id));
                        if (img) img.notes = note;
                    });
                    
                    // Restore trashed images
                    trashedImages = new Set(state.trashedImages || []);
                } catch (e) {
                    console.warn('Failed to load saved state:', e);
                }
            }
        }
        
        function restoreCustomFolders() {
            const folderList = document.querySelector('.folder-list');
            const newFolderBtn = folderList.lastElementChild;
            
            customFolders.forEach(folder => {
                const folderElement = document.createElement('div');
                folderElement.className = 'folder-item';
                folderElement.dataset.filter = folder.id;
                
                folderElement.innerHTML = `
                    <div class="folder-left">
                        <span class="folder-icon">📁</span>
                        <span class="folder-name">${folder.name}</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 4px;">
                        <button class="rename-btn" onclick="renameFolder('${folder.id}')" title="Rename">✏️</button>
                        <span class="folder-count">${folderContents[folder.id] ? folderContents[folder.id].size : 0}</span>
                    </div>
                `;
                
                folderElement.addEventListener('click', handleFolderClick);
                folderList.insertBefore(folderElement, newFolderBtn);
            });
        }
        
        function restoreUIState() {
            // Update all star ratings in the UI
            imageData.forEach(img => {
                if (img.rating > 0) {
                    document.querySelectorAll(`.rating-stars[data-id="${img.id}"]`).forEach(starsContainer => {
                        const stars = starsContainer.querySelectorAll('.star');
                        stars.forEach((star, index) => {
                            star.classList.toggle('filled', index < img.rating);
                        });
                    });
                }
            });
            
            // Update checkboxes for selected images
            selectedImages.forEach(imageId => {
                document.querySelectorAll(`[data-id="${imageId}"]`).forEach(checkbox => {
                    if (checkbox.classList.contains('image-checkbox') ||
                        checkbox.classList.contains('list-checkbox') ||
                        checkbox.classList.contains('filmstrip-checkbox')) {
                        checkbox.classList.add('checked');
                    }
                });
            });
        }

        // Initialize everything
        function init() {
            loadState();
            generateGalleryItems();
            restoreCustomFolders();
            restoreUIState();
            setupEventListeners();
            updateSelectionBasket();
            
            // Initialize name visibility based on showNames state
            updateNameVisibility();
            
            // Initialize filmstrip height from slider value
            const sizeSlider = document.getElementById('sizeSlider');
            if (sizeSlider) {
                const sizeValue = parseInt(sizeSlider.value);
                const windowHeight = window.innerHeight - 64 - 40;
                const minHeight = Math.min(300, windowHeight * 0.6);
                const maxHeight = Math.min(windowHeight * 0.85, 600);
                const sliderRange = 400 - 150;
                const heightRange = maxHeight - minHeight;
                const normalizedValue = (sizeValue - 150) / sliderRange;
                const filmstripHeight = minHeight + (normalizedValue * heightRange);
                document.documentElement.style.setProperty('--filmstrip-height', filmstripHeight + 'px');
            }
        }
        
        // Update name visibility across all views
        function updateNameVisibility() {
            const showNamesToggle = document.getElementById('showNamesToggle');
            showNamesToggle.classList.toggle('active', showNames);
            
            document.querySelectorAll('.image-name, .filmstrip-name').forEach(name => {
                name.classList.toggle('hidden', !showNames);
            });
            
            document.querySelectorAll('.list-filename').forEach(name => {
                name.classList.toggle('hidden', !showNames);
            });
            
            document.querySelectorAll('.image-info').forEach(info => {
                info.classList.toggle('hidden', !showNames);
            });
        }

        // Generate all gallery items
        function generateGalleryItems() {
            const galleryGrid = document.getElementById('galleryGrid');
            const listItemsContainer = document.getElementById('listItemsContainer');
            const filmstripContainer = document.getElementById('filmstripContainer');
            
            // Clear existing items
            galleryGrid.innerHTML = '';
            listItemsContainer.innerHTML = '';
            filmstripContainer.innerHTML = '';

            imageData.forEach(img => {
                // Grid View Item
                const gridItem = document.createElement('div');
                gridItem.className = 'gallery-item';
                gridItem.dataset.imageId = img.id;
                
                gridItem.innerHTML = `
                    <div class="image-name">${img.name}</div>
                    <div class="image-container">
                        <img src="${img.url}" alt="${img.name}" class="gallery-image" draggable="true" data-image-id="${img.id}">
                        <div class="image-checkbox" data-id="${img.id}"></div>
                        <button class="move-to-trash-btn" onclick="moveToTrash(${img.id}, event)" title="Move to Trash">🗑️</button>
                    </div>
                    <div class="image-info">
                        <div class="rating-stars" data-id="${img.id}">
                            ${[1,2,3,4,5].map(star => `
                                <svg class="star" data-star="${star}" data-id="${img.id}" viewBox="0 0 24 24">
                                    <polygon points="12,2 15,8.5 22,9.5 17,14.5 18,21.5 12,18 6,21.5 7,14.5 2,9.5 9,8.5"/>
                                </svg>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                galleryGrid.appendChild(gridItem);
                
                // Enhanced List View Item
                const listItem = document.createElement('div');
                listItem.className = 'list-item';
                listItem.dataset.imageId = img.id;
                
                listItem.innerHTML = `
                    <div class="list-checkbox" data-id="${img.id}"></div>
                    <img src="${img.url}" alt="${img.name}" class="list-thumbnail" draggable="true" data-image-id="${img.id}">
                    <div class="list-filename">${img.name}</div>
                    <div class="list-details">${img.size}</div>
                    <div class="list-details">${img.dimensions}</div>
                    <div class="list-details">${img.date}</div>
                    <div class="list-rating rating-stars" data-id="${img.id}">
                        ${[1,2,3,4,5].map(star => `
                            <svg class="star" data-star="${star}" data-id="${img.id}" viewBox="0 0 24 24">
                                <polygon points="12,2 15,8.5 22,9.5 17,14.5 18,21.5 12,18 6,21.5 7,14.5 2,9.5 9,8.5"/>
                            </svg>
                        `).join('')}
                    </div>
                    <textarea class="list-notes" placeholder="Add notes..." data-id="${img.id}" rows="1">${img.notes}</textarea>
                `;
                
                listItemsContainer.appendChild(listItem);
                
                // Filmstrip View Item
                const filmstripItem = document.createElement('div');
                filmstripItem.className = 'filmstrip-item';
                filmstripItem.dataset.imageId = img.id;
                
                filmstripItem.innerHTML = `
                    <div class="filmstrip-image-container">
                        <img src="${img.url}" alt="${img.name}" class="filmstrip-image" draggable="true" data-image-id="${img.id}">
                        <div class="filmstrip-checkbox" data-id="${img.id}"></div>
                        <div class="filmstrip-info">
                            <div class="filmstrip-name">${img.name}</div>
                            <div class="filmstrip-rating rating-stars" data-id="${img.id}">
                                ${[1,2,3,4,5].map(star => `
                                    <svg class="star" data-star="${star}" data-id="${img.id}" viewBox="0 0 24 24">
                                        <polygon points="12,2 15,8.5 22,9.5 17,14.5 18,21.5 12,18 6,21.5 7,14.5 2,9.5 9,8.5"/>
                                    </svg>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                filmstripContainer.appendChild(filmstripItem);
            });
        }

        // Filter gallery items based on folder selection
        function filterGallery(filter) {
            currentFilter = filter;
            const allItems = document.querySelectorAll('.gallery-item, .list-item, .filmstrip-item');
            
            allItems.forEach(item => {
                const imageId = item.dataset.imageId;
                const img = imageData.find(i => i.id === parseInt(imageId));
                let show = false;
                
                if (filter.startsWith('custom-')) {
                    // Custom folder - check if image is in this folder
                    show = folderContents[filter] && folderContents[filter].has(imageId);
                } else {
                    switch(filter) {
                        case 'all':
                            show = true;
                            break;
                        case 'favorites':
                            show = favoriteImages.has(imageId);
                            break;
                        case 'selected':
                            show = selectedImages.has(imageId);
                            break;
                        case 'rated':
                            show = img && img.rating > 0;
                            break;
                        case 'trash':
                            show = trashedImages.has(imageId);
                            break;
                        default:
                            show = true;
                    }
                }
                
                item.style.display = show ? '' : 'none';
            });
        }

        // Setup all event listeners
        function setupEventListeners() {
            // View Toggle
            document.querySelectorAll('.view-icon-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchView(btn.dataset.view);
                });
            });

            // Show/Hide Names Toggle
            const showNamesToggle = document.getElementById('showNamesToggle');
            showNamesToggle.addEventListener('click', () => {
                showNames = !showNames;
                updateNameVisibility();
            });

            // Fullscreen Toggle
            const fullscreenToggle = document.getElementById('fullscreenToggle');
            fullscreenToggle.addEventListener('click', toggleFullscreen);

            // Size Slider - affects both grid and filmstrip
            const sizeSlider = document.getElementById('sizeSlider');
            sizeSlider.addEventListener('input', (e) => {
                const size = e.target.value + 'px';
                const sizeValue = parseInt(e.target.value);
                
                // Set grid size
                document.documentElement.style.setProperty('--icon-size', size);
                
                // Set filmstrip size based on slider with window constraints
                const windowHeight = window.innerHeight - 64 - 40; // Account for header and padding
                const minHeight = Math.min(300, windowHeight * 0.6); // Minimum 60% of available height
                const maxHeight = Math.min(windowHeight * 0.85, 600); // Maximum 85% of available height
                
                // Map slider range to height range
                const sliderRange = 400 - 150; // Slider range (150 to 400)
                const heightRange = maxHeight - minHeight;
                const normalizedValue = (sizeValue - 150) / sliderRange; // 0 to 1
                const filmstripHeight = minHeight + (normalizedValue * heightRange);
                
                document.documentElement.style.setProperty('--filmstrip-height', filmstripHeight + 'px');
            });

            // Checkbox clicks
            document.addEventListener('click', handleCheckboxClick);

            // Star rating clicks
            document.addEventListener('click', handleStarClick);

            // Folder selection
            document.querySelectorAll('.folder-item').forEach(folder => {
                folder.addEventListener('click', handleFolderClick);
            });
            
            // New Folder button
            document.querySelector('.folder-item:last-child').addEventListener('click', (e) => {
                if (e.currentTarget.querySelector('span').textContent.includes('New Folder')) {
                    e.stopPropagation();
                    createNewFolder();
                }
            });

            // Info toggle
            const infoToggle = document.getElementById('infoToggle');
            infoToggle.addEventListener('click', toggleInfoPanel);
            
            // Trash button (for deleting selected custom folders)
            document.getElementById('trashBtn').addEventListener('click', deleteSelectedFolder);
            
            // Show/hide trash button based on folder selection
            document.addEventListener('click', updateTrashButtonVisibility);

            // Notes handling
            document.addEventListener('input', (e) => {
                if (e.target.classList.contains('list-notes')) {
                    const id = e.target.dataset.id;
                    const img = imageData.find(i => i.id === parseInt(id));
                    if (img) {
                        img.notes = e.target.value;
                        imageNotes[id] = e.target.value;
                    }
                }
            });

            // Finalize button
            document.getElementById('finalizeBtn').addEventListener('click', () => {
                if (selectedImages.size === 0) {
                    alert('Please select at least one image to finalize.');
                } else {
                    alert(`Finalizing ${selectedImages.size} selected images...`);
                }
            });

            // Setup resizable sidebars
            makeResizable(document.getElementById('leftSidebar'), document.getElementById('leftResizeHandle'), true);
            makeResizable(document.getElementById('rightSidebar'), document.getElementById('rightResizeHandle'), false);
            
            // Setup drag and drop
            setupDragAndDrop();
            
            // Setup filmstrip scroll detection
            setupFilmstripScrollDetection();
            
            // Setup filmstrip thumbnails
            setupFilmstripThumbnails();
            
            // Setup exit fullscreen button click handler
            const exitFullscreenBtn = document.querySelector('.exit-fullscreen-btn');
            if (exitFullscreenBtn) {
                exitFullscreenBtn.addEventListener('click', () => {
                    toggleFullscreen();
                });
            }
        }

        // Switch view modes
        function switchView(view) {
            document.querySelectorAll('.view-icon-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            currentView = view;
            
            // Hide all views
            document.getElementById('galleryGrid').classList.remove('list-view', 'filmstrip-view');
            document.getElementById('galleryList').classList.remove('list-view', 'filmstrip-view');
            document.getElementById('galleryFilmstrip').classList.remove('filmstrip-view');
            document.body.classList.remove('filmstrip-view');
            
            // Show fullscreen toggle only for filmstrip
            const fullscreenToggle = document.getElementById('fullscreenToggle');
            const galleryFilmstrip = document.getElementById('galleryFilmstrip');
            fullscreenToggle.classList.toggle('visible', view === 'filmstrip');
            
            // Show appropriate view
            if (view === 'list') {
                document.getElementById('galleryGrid').classList.add('list-view');
                document.getElementById('galleryList').classList.add('list-view');
            } else if (view === 'filmstrip') {
                document.getElementById('galleryGrid').classList.add('filmstrip-view');
                document.getElementById('galleryFilmstrip').classList.add('filmstrip-view');
                document.body.classList.add('filmstrip-view');
                
                // Trigger featured image update for filmstrip
                setTimeout(() => {
                    document.dispatchEvent(new CustomEvent('viewChanged'));
                }, 100);
            }
        }

        // Toggle fullscreen for filmstrip
        function toggleFullscreen() {
            const filmstrip = document.getElementById('galleryFilmstrip');
            const fullscreenToggle = document.getElementById('fullscreenToggle');
            const mainHeader = document.getElementById('mainHeader');
            const dashboardContainer = document.getElementById('dashboardContainer');
            const leftSidebar = document.getElementById('leftSidebar');
            const rightSidebar = document.getElementById('rightSidebar');
            const finalizeBtn = document.getElementById('finalizeBtn');
            
            const isFullscreen = filmstrip.classList.contains('fullscreen');
            
            filmstrip.classList.toggle('fullscreen');
            fullscreenToggle.classList.toggle('active');
            mainHeader.classList.toggle('filmstrip-fullscreen');
            dashboardContainer.classList.toggle('filmstrip-fullscreen');
            leftSidebar.classList.toggle('filmstrip-fullscreen');
            rightSidebar.classList.toggle('filmstrip-fullscreen');
            finalizeBtn.classList.toggle('filmstrip-fullscreen');
            
            // Recalculate scaling after fullscreen change
            setTimeout(() => {
                // Trigger a custom event to update filmstrip scaling
                document.dispatchEvent(new CustomEvent('fullscreenChanged'));
            }, 100);
        }
        
        // Exit fullscreen function (global scope)
        window.exitFullscreen = function() {
            toggleFullscreen();
        };

        // Handle checkbox clicks
        function handleCheckboxClick(e) {
            if (e.target.classList.contains('image-checkbox') || 
                e.target.classList.contains('list-checkbox') ||
                e.target.classList.contains('filmstrip-checkbox')) {
                e.stopPropagation();
                const id = e.target.dataset.id;
                
                // Toggle selection
                if (selectedImages.has(id)) {
                    selectedImages.delete(id);
                } else {
                    selectedImages.add(id);
                }
                
                // Update UI for all views
                document.querySelectorAll(`[data-id="${id}"]`).forEach(checkbox => {
                    if (checkbox.classList.contains('image-checkbox') || 
                        checkbox.classList.contains('list-checkbox') ||
                        checkbox.classList.contains('filmstrip-checkbox')) {
                        checkbox.classList.toggle('checked', selectedImages.has(id));
                    }
                });
                
                updateSelectionBasket();
                updateFolderCounts();
            }
            
            // Remove from basket
            if (e.target.classList.contains('remove-btn')) {
                const id = e.target.dataset.id;
                selectedImages.delete(id);
                
                // Update checkboxes
                document.querySelectorAll(`[data-id="${id}"]`).forEach(checkbox => {
                    if (checkbox.classList.contains('image-checkbox') || 
                        checkbox.classList.contains('list-checkbox') ||
                        checkbox.classList.contains('filmstrip-checkbox')) {
                        checkbox.classList.remove('checked');
                    }
                });
                
                updateSelectionBasket();
                updateFolderCounts();
                saveState();
            }
        }

        // Handle star rating clicks
        function handleStarClick(e) {
            const star = e.target.closest('.star');
            if (star) {
                e.stopPropagation();
                e.preventDefault();
                const rating = parseInt(star.dataset.star);
                const imageId = star.dataset.id;
                
                // Update rating in data
                const img = imageData.find(i => i.id === parseInt(imageId));
                if (!img) return;
                
                img.rating = rating;
                
                // Update favorites
                if (rating === 5) {
                    favoriteImages.add(imageId);
                } else {
                    favoriteImages.delete(imageId);
                }
                
                // Update all star containers for this image
                document.querySelectorAll(`.rating-stars[data-id="${imageId}"]`).forEach(starsContainer => {
                    const stars = starsContainer.querySelectorAll('.star');
                    stars.forEach((star, index) => {
                        star.classList.toggle('filled', index < rating);
                    });
                });
                
                updateFolderCounts();
                saveState();
                
                // Trigger folder change if currently viewing favorites/rated (since ratings affect these folders)
                if (currentFilter === 'favorites' || currentFilter === 'rated') {
                    document.dispatchEvent(new CustomEvent('folderChanged'));
                }
            }
        }

        // Handle folder clicks
        function handleFolderClick(e) {
            const folder = e.currentTarget;
            const filter = folder.dataset.filter;
            
            if (!filter) return; // Skip "New Folder" item
            
            document.querySelectorAll('.folder-item').forEach(f => f.classList.remove('active'));
            folder.classList.add('active');
            
            filterGallery(filter);
            updateTrashButtonVisibility();
            
            // Trigger folder change event for thumbnail regeneration
            document.dispatchEvent(new CustomEvent('folderChanged'));
            
            // Also trigger filmstrip cache update since visible items changed
            if (currentView === 'filmstrip') {
                setTimeout(() => {
                    document.dispatchEvent(new CustomEvent('viewChanged'));
                }, 50);
            }
        }

        // Toggle info panel
        function toggleInfoPanel() {
            const infoToggle = document.getElementById('infoToggle');
            const basketContent = document.getElementById('basketContent');
            const detailsPanel = document.getElementById('detailsPanel');
            
            const showingDetails = detailsPanel.classList.contains('active');
            
            if (showingDetails) {
                detailsPanel.classList.remove('active');
                basketContent.style.display = 'block';
                infoToggle.classList.remove('active');
            } else {
                detailsPanel.classList.add('active');
                basketContent.style.display = 'none';
                infoToggle.classList.add('active');
            }
        }

        // Update folder counts
        function updateFolderCounts() {
            // Count rated images
            const ratedCount = imageData.filter(img => img.rating > 0).length;
            
            // Update folder counts
            document.querySelector('[data-filter="all"] .folder-count').textContent = imageData.length;
            document.querySelector('[data-filter="favorites"] .folder-count').textContent = favoriteImages.size;
            document.querySelector('[data-filter="selected"] .folder-count').textContent = selectedImages.size;
            document.querySelector('[data-filter="rated"] .folder-count').textContent = ratedCount;
            document.querySelector('#trashCount').textContent = trashedImages.size;
        }

        // Update selection basket
        function updateSelectionBasket() {
            const basketBadge = document.getElementById('basketBadge');
            const selectionGrid = document.getElementById('selectionGrid');
            const emptyBasket = document.getElementById('emptyBasket');
            
            basketBadge.textContent = selectedImages.size;
            
            // Update basket view
            if (selectedImages.size === 0) {
                selectionGrid.style.display = 'none';
                emptyBasket.style.display = 'block';
            } else {
                selectionGrid.style.display = 'grid';
                emptyBasket.style.display = 'none';
                
                // Clear and rebuild selection grid
                selectionGrid.innerHTML = '';
                selectedImages.forEach(id => {
                    const img = imageData.find(i => i.id === parseInt(id));
                    if (img) {
                        const basketItem = document.createElement('div');
                        basketItem.className = 'basket-item';
                        basketItem.innerHTML = `
                            <img src="${img.url}" class="basket-thumb" alt="${img.name}">
                            <div class="remove-btn" data-id="${id}">×</div>
                        `;
                        selectionGrid.appendChild(basketItem);
                    }
                });
            }
        }

        // Sidebar resizing
        function makeResizable(sidebar, handle, isLeft = true) {
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            handle.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = parseInt(document.defaultView.getComputedStyle(sidebar).width, 10);
                handle.classList.add('dragging');
                document.body.style.cursor = 'col-resize';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                
                let newWidth;
                if (isLeft) {
                    newWidth = startWidth + (e.clientX - startX);
                } else {
                    newWidth = startWidth - (e.clientX - startX);
                }
                
                // Apply constraints
                const minWidth = isLeft ? 180 : 250;
                const maxWidth = isLeft ? 400 : 500;
                
                newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
                sidebar.style.width = newWidth + 'px';
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    handle.classList.remove('dragging');
                    document.body.style.cursor = 'default';
                }
            });
        }

        // Click on image to select and show details
        document.addEventListener('click', (e) => {
            const galleryItem = e.target.closest('.gallery-item, .list-item, .filmstrip-item');
            if (galleryItem && !e.target.classList.contains('image-checkbox') && 
                !e.target.classList.contains('list-checkbox') && 
                !e.target.classList.contains('filmstrip-checkbox') && 
                !e.target.classList.contains('star') &&
                !e.target.classList.contains('move-to-trash-btn') &&
                !e.target.classList.contains('list-notes')) {
                
                const imageId = galleryItem.dataset.imageId;
                const img = imageData.find(i => i.id === parseInt(imageId));
                
                if (img) {
                    // Select the image
                    selectedImages.add(imageId);
                    
                    // Update checkbox visual state
                    document.querySelectorAll(`[data-id="${imageId}"]`).forEach(checkbox => {
                        if (checkbox.classList.contains('image-checkbox') ||
                            checkbox.classList.contains('list-checkbox') ||
                            checkbox.classList.contains('filmstrip-checkbox')) {
                            checkbox.classList.add('checked');
                        }
                    });
                    
                    updateSelectionBasket();
                    updateFolderCounts();
                    saveState();
                    
                    // Show details if panel is active
                    if (document.getElementById('detailsPanel').classList.contains('active')) {
                        document.getElementById('detailFileName').textContent = img.name;
                        document.getElementById('detailDimensions').textContent = img.dimensions;
                        document.getElementById('detailFileSize').textContent = img.size;
                        document.getElementById('detailDate').textContent = img.date;
                        document.getElementById('detailCamera').textContent = img.camera;
                    }
                }
            }
        });

        // Create new folder functionality
        function createNewFolder() {
            const folderName = prompt('Enter folder name:');
            if (!folderName || !folderName.trim()) return;
            
            const folderId = 'custom-' + Date.now();
            const newFolder = {
                id: folderId,
                name: folderName.trim()
            };
            
            customFolders.push(newFolder);
            folderContents[folderId] = new Set();
            
            // Create DOM element
            const folderList = document.querySelector('.folder-list');
            const newFolderBtn = folderList.lastElementChild;
            
            const folderElement = document.createElement('div');
            folderElement.className = 'folder-item';
            folderElement.dataset.filter = folderId;
            
            folderElement.innerHTML = `
                <div class="folder-left">
                    <span class="folder-icon">📁</span>
                    <span class="folder-name">${newFolder.name}</span>
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <button class="rename-btn" onclick="renameFolder('${folderId}')" title="Rename">✏️</button>
                    <span class="folder-count">0</span>
                </div>
            `;
            
            folderElement.addEventListener('click', handleFolderClick);
            folderList.insertBefore(folderElement, newFolderBtn);
            saveState();
        }
        
        // Rename folder functionality
        function renameFolder(folderId) {
            event.stopPropagation();
            const folder = customFolders.find(f => f.id === folderId);
            if (!folder) return;
            
            const newName = prompt('Rename folder:', folder.name);
            if (!newName || !newName.trim() || newName.trim() === folder.name) return;
            
            folder.name = newName.trim();
            
            // Update DOM
            const folderElement = document.querySelector(`[data-filter="${folderId}"]`);
            if (folderElement) {
                const nameElement = folderElement.querySelector('.folder-name');
                if (nameElement) {
                    nameElement.textContent = newName.trim();
                }
            }
            saveState();
        }
        
        // Delete folder functionality
        function deleteFolder(folderId) {
            event.stopPropagation();
            const folderIndex = customFolders.findIndex(f => f.id === folderId);
            if (folderIndex === -1) return;
            
            if (confirm('Are you sure you want to delete this folder?')) {
                customFolders.splice(folderIndex, 1);
                delete folderContents[folderId];
                
                // Remove from DOM
                const folderElement = document.querySelector(`[data-filter="${folderId}"]`);
                if (folderElement) {
                    folderElement.remove();
                }
                
                // Switch to "All Images" if this folder was active
                if (currentFilter === folderId) {
                    document.querySelector('[data-filter="all"]').click();
                }
                saveState();
            }
        }
        
        // Delete selected folder (from trash button)
        function deleteSelectedFolder() {
            if (currentFilter && currentFilter.startsWith('custom-')) {
                deleteFolder(currentFilter);
            }
        }
        
        // Show/hide trash button based on selected folder
        function updateTrashButtonVisibility() {
            const trashBtn = document.getElementById('trashBtn');
            const isCustomFolder = currentFilter && currentFilter.startsWith('custom-');
            trashBtn.classList.toggle('visible', isCustomFolder);
        }
        
        // Move image to trash (organizational only - no S3 deletion)
        function moveToTrash(imageId, event) {
            event.stopPropagation();
            const id = String(imageId);
            
            // Add to trash
            trashedImages.add(id);
            
            // Remove from other folders if present
            Object.keys(folderContents).forEach(folderId => {
                if (folderContents[folderId].has(id)) {
                    folderContents[folderId].delete(id);
                }
            });
            
            // Update UI
            updateFolderCounts();
            saveState();
            
            // If currently viewing the image, hide it from current view unless in trash
            if (currentFilter !== 'trash') {
                const imageElements = document.querySelectorAll(`[data-image-id="${imageId}"]`);
                imageElements.forEach(el => {
                    el.style.display = 'none';
                });
            }
        }
        
        // Setup drag and drop functionality
        function setupDragAndDrop() {
            let draggedImages = [];
            let dragPreview = null;
            
            // Handle drag start
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('gallery-image')) {
                    const imageId = e.target.dataset.imageId;
                    
                    // If dragged image is selected, drag all selected images
                    if (selectedImages.has(imageId)) {
                        draggedImages = Array.from(selectedImages);
                    } else {
                        draggedImages = [imageId];
                        // Select the dragged image
                        selectedImages.add(imageId);
                        updateSelectionBasket();
                        updateFolderCounts();
                    }
                    
                    // Create drag preview
                    dragPreview = document.createElement('div');
                    dragPreview.className = 'drag-preview';
                    dragPreview.textContent = draggedImages.length === 1 ? '1 image' : `${draggedImages.length} images`;
                    document.body.appendChild(dragPreview);
                    
                    // Style dragged items
                    draggedImages.forEach(id => {
                        document.querySelectorAll(`[data-image-id="${id}"]`).forEach(el => {
                            const item = el.closest('.gallery-item, .list-item, .filmstrip-item');
                            if (item) item.classList.add('dragging');
                        });
                    });
                    
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', draggedImages.join(','));
                }
            });
            
            // Handle drag over folders
            document.addEventListener('dragover', (e) => {
                const folderItem = e.target.closest('.folder-item');
                if (folderItem && (folderItem.dataset.filter === 'trash' || folderItem.dataset.filter.startsWith('custom-'))) {
                    e.preventDefault();
                    folderItem.classList.add('drop-target');
                    
                    // Update drag preview position
                    if (dragPreview) {
                        dragPreview.style.left = (e.clientX + 10) + 'px';
                        dragPreview.style.top = (e.clientY - 10) + 'px';
                    }
                }
            });
            
            // Handle drag leave
            document.addEventListener('dragleave', (e) => {
                const folderItem = e.target.closest('.folder-item');
                if (folderItem) {
                    folderItem.classList.remove('drop-target');
                }
            });
            
            // Handle drop
            document.addEventListener('drop', (e) => {
                e.preventDefault();
                const folderItem = e.target.closest('.folder-item');
                
                if (folderItem && draggedImages.length > 0) {
                    const targetFolder = folderItem.dataset.filter;
                    
                    if (targetFolder === 'trash') {
                        // Move to trash
                        draggedImages.forEach(imageId => {
                            trashedImages.add(imageId);
                            // Remove from other folders
                            Object.keys(folderContents).forEach(folderId => {
                                if (folderContents[folderId].has(imageId)) {
                                    folderContents[folderId].delete(imageId);
                                }
                            });
                        });
                    } else if (targetFolder.startsWith('custom-')) {
                        // Move to custom folder
                        if (!folderContents[targetFolder]) {
                            folderContents[targetFolder] = new Set();
                        }
                        
                        draggedImages.forEach(imageId => {
                            // Remove from trash if present
                            trashedImages.delete(imageId);
                            
                            // Remove from ALL other custom folders
                            Object.keys(folderContents).forEach(folderId => {
                                if (folderId !== targetFolder && folderContents[folderId].has(imageId)) {
                                    folderContents[folderId].delete(imageId);
                                }
                            });
                            
                            // Add to target folder
                            folderContents[targetFolder].add(imageId);
                        });
                    }
                    
                    updateFolderCounts();
                    saveState();
                    
                    // Update UI if not viewing the target folder
                    if (currentFilter !== targetFolder && currentFilter !== 'all' && currentFilter !== 'selected') {
                        draggedImages.forEach(imageId => {
                            document.querySelectorAll(`[data-image-id="${imageId}"]`).forEach(el => {
                                el.style.display = 'none';
                            });
                        });
                    }
                }
                
                // Cleanup
                document.querySelectorAll('.drop-target').forEach(item => {
                    item.classList.remove('drop-target');
                });
                document.querySelectorAll('.dragging').forEach(item => {
                    item.classList.remove('dragging');
                });
                
                if (dragPreview) {
                    dragPreview.remove();
                    dragPreview = null;
                }
                
                draggedImages = [];
            });
            
            // Handle drag end
            document.addEventListener('dragend', (e) => {
                // Cleanup
                document.querySelectorAll('.drop-target').forEach(item => {
                    item.classList.remove('drop-target');
                });
                document.querySelectorAll('.dragging').forEach(item => {
                    item.classList.remove('dragging');
                });
                
                if (dragPreview) {
                    dragPreview.remove();
                    dragPreview = null;
                }
                
                draggedImages = [];
            });
        }

        // Setup filmstrip scroll detection for featured image scaling
        function setupFilmstripScrollDetection() {
            const filmstrip = document.getElementById('galleryFilmstrip');
            let currentFeaturedItem = null;
            let cachedItems = [];
            let containerWidth = 0;
            
            function cacheElements() {
                const filmstripContainer = document.getElementById('filmstripContainer');
                if (!filmstripContainer) return;
                cachedItems = Array.from(filmstripContainer.querySelectorAll('.filmstrip-item'));
                containerWidth = filmstrip.clientWidth;
                console.log('Cached elements:', cachedItems.length, 'Container width:', containerWidth);
            }
            
            function updateFeaturedImage() {
                if (currentView !== 'filmstrip' || cachedItems.length === 0) return;
                
                const scrollLeft = filmstrip.scrollLeft;
                const centerPoint = scrollLeft + (containerWidth / 2);
                const maxDistance = containerWidth * 0.7; // Distance where scaling starts - increased for earlier response
                
                // Apply progressive scaling to all visible items  
                for (let i = 0; i < cachedItems.length; i++) {
                    const item = cachedItems[i];
                    if (item.style.display === 'none') continue;
                    
                    // Simple, reliable offset-based calculation
                    const itemLeft = item.offsetLeft;
                    const itemWidth = item.offsetWidth;
                    const itemCenter = itemLeft + (itemWidth / 2);
                    const distance = Math.abs(centerPoint - itemCenter);
                    
                    // Calculate scale and opacity based on distance from center
                    let scale, opacity, borderOpacity = 0, shadowOpacity = 0;
                    
                    if (distance <= maxDistance) {
                        // Progressive scaling: closer to center = larger
                        const proximity = Math.max(0, (maxDistance - distance) / maxDistance); // Ensure 0 to 1 range
                        scale = 0.7 + (proximity * 0.5); // 0.7 to 1.2 (linear progression)
                        opacity = 0.3 + (proximity * 0.7); // 0.3 to 1.0 (linear progression)
                        
                        // Add border and shadow effect when close to center
                        if (proximity > 0.3) {
                            borderOpacity = Math.min(1, (proximity - 0.3) / 0.7);
                            shadowOpacity = Math.min(1, (proximity - 0.3) / 0.7);
                        }
                        
                        // Z-index based on proximity - center image always on top
                        const zIndex = Math.floor(10 + proximity * 10);
                        item.style.zIndex = zIndex;
                    } else {
                        // Far from center - minimum scale
                        scale = 0.7;
                        opacity = 0.3;
                        item.style.zIndex = 1;
                    }
                    
                    // Apply transforms directly for maximum performance
                    item.style.transform = `scale(${scale})`;
                    item.style.opacity = opacity;
                    
                    if (borderOpacity > 0) {
                        item.style.borderColor = `rgba(255, 107, 53, ${borderOpacity})`;
                        item.style.boxShadow = `0 12px 40px rgba(255, 107, 53, ${0.3 * shadowOpacity})`;
                    } else {
                        item.style.borderColor = 'rgba(255, 255, 255, 0.05)';
                        item.style.boxShadow = 'none';
                    }
                }
            }
            
            // Ultra-high frequency scroll handler with passive listening
            filmstrip.addEventListener('scroll', updateFeaturedImage, { passive: true });
            
            // Update when switching to filmstrip view
            const filmstripViewBtn = document.querySelector('[data-view="filmstrip"]');
            if (filmstripViewBtn) {
                filmstripViewBtn.addEventListener('click', () => {
                    setTimeout(() => {
                        cacheElements();
                        updateFeaturedImage();
                    }, 50);
                });
            }
            
            // Update when entering/exiting fullscreen
            document.addEventListener('fullscreenChanged', () => {
                setTimeout(() => {
                    cacheElements();
                    updateFeaturedImage();
                }, 150);
            });
            
            // Update on window resize with element recaching
            window.addEventListener('resize', () => {
                cacheElements();
                setTimeout(updateFeaturedImage, 10);
            });
            
            // Initial setup
            setTimeout(() => {
                cacheElements();
                updateFeaturedImage();
            }, 100);
        }

        // Setup filmstrip thumbnail footer
        function setupFilmstripThumbnails() {
            const thumbnailContainer = document.getElementById('thumbnailContainer');
            const thumbnailFooter = document.getElementById('filmstripThumbnails');
            let activeThumbnailIndex = 0;
            
            // Update footer width based on sidebar positions
            function updateFooterWidth() {
                if (!thumbnailFooter) return;
                
                const leftSidebar = document.getElementById('leftSidebar');
                const rightSidebar = document.getElementById('rightSidebar');
                
                if (leftSidebar && rightSidebar) {
                    const leftWidth = leftSidebar.offsetWidth;
                    const rightWidth = rightSidebar.offsetWidth;
                    
                    thumbnailFooter.style.left = leftWidth + 'px';
                    thumbnailFooter.style.right = rightWidth + 'px';
                }
            }
            
            function generateThumbnails() {
                if (!thumbnailContainer) return;
                
                thumbnailContainer.innerHTML = '';
                
                // Get ONLY currently visible filmstrip items and extract their actual image sources
                const filmstripItems = document.querySelectorAll('.filmstrip-item');
                const visibleThumbnails = [];
                
                filmstripItems.forEach(item => {
                    if (item.style.display !== 'none') {
                        const imageId = item.dataset.imageId;
                        
                        // Find the actual image element in the filmstrip item
                        const filmstripImage = item.querySelector('.filmstrip-image');
                        
                        if (filmstripImage && filmstripImage.src && !filmstripImage.src.includes('undefined')) {
                            visibleThumbnails.push({
                                imageId: imageId,
                                src: filmstripImage.src,
                                alt: filmstripImage.alt || `Image ${imageId}`
                            });
                        }
                    }
                });
                
                console.log('Generated thumbnails:', visibleThumbnails.length); // Debug log
                
                // Generate thumbnails using the actual filmstrip image sources
                visibleThumbnails.forEach((thumbData, index) => {
                    const thumbnail = document.createElement('img');
                    thumbnail.src = thumbData.src;
                    thumbnail.alt = thumbData.alt;
                    thumbnail.className = 'filmstrip-thumbnail';
                    thumbnail.dataset.index = index;
                    thumbnail.dataset.imageId = thumbData.imageId;
                    
                    console.log(`Creating thumbnail ${index}:`, thumbData.src); // Debug log
                    
                    // Click handler to jump to image
                    thumbnail.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log(`Thumbnail clicked: index ${index}, imageId ${thumbData.imageId}`); // Debug log
                        
                        // Only scroll if not already active (requirement #4)
                        if (index !== activeThumbnailIndex) {
                            jumpToFilmstripImage(index);
                            updateActiveThumbnail(index);
                        } else {
                            console.log('Already active thumbnail - no action'); // Debug log
                        }
                    });
                    
                    thumbnailContainer.appendChild(thumbnail);
                });
                
                // Set first thumbnail as active initially if any visible images exist
                if (visibleThumbnails.length > 0) {
                    updateActiveThumbnail(0);
                }
            }
            
            function jumpToFilmstripImage(index) {
                const filmstripContainer = document.getElementById('filmstripContainer');
                const filmstripItems = Array.from(filmstripContainer.querySelectorAll('.filmstrip-item')).filter(item => item.style.display !== 'none');
                
                if (filmstripItems[index]) {
                    const item = filmstripItems[index];
                    const filmstrip = document.getElementById('galleryFilmstrip');
                    
                    // Calculate scroll position to center the selected image
                    const itemLeft = item.offsetLeft;
                    const itemWidth = item.offsetWidth;
                    const containerWidth = filmstrip.clientWidth;
                    const targetScrollLeft = itemLeft - (containerWidth / 2) + (itemWidth / 2);
                    
                    console.log(`Jumping to image ${index}:`, targetScrollLeft); // Debug log
                    
                    filmstrip.scrollTo({
                        left: Math.max(0, targetScrollLeft),
                        behavior: 'smooth'
                    });
                }
            }
            
            function updateActiveThumbnail(index) {
                const thumbnails = thumbnailContainer.querySelectorAll('.filmstrip-thumbnail');
                thumbnails.forEach((thumb, i) => {
                    thumb.classList.toggle('active', i === index);
                });
                activeThumbnailIndex = index;
                
                // Auto-scroll thumbnail strip to keep active thumbnail visible
                const activeThumbnail = thumbnails[index];
                if (activeThumbnail) {
                    activeThumbnail.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest',
                        inline: 'center'
                    });
                }
            }
            
            // Generate thumbnails when switching to filmstrip view or folder changes
            document.addEventListener('viewChanged', () => {
                if (currentView === 'filmstrip') {
                    setTimeout(generateThumbnails, 100);
                }
            });
            
            // Regenerate thumbnails when folder selection changes
            document.addEventListener('folderChanged', () => {
                if (currentView === 'filmstrip') {
                    setTimeout(generateThumbnails, 50);
                }
            });
            
            // Update active thumbnail based on filmstrip scroll
            function updateThumbnailFromFilmstrip() {
                if (currentView !== 'filmstrip') return;
                
                const filmstripContainer = document.getElementById('filmstripContainer');
                const filmstrip = document.getElementById('galleryFilmstrip');
                const visibleItems = Array.from(filmstripContainer.querySelectorAll('.filmstrip-item')).filter(item => item.style.display !== 'none');
                
                if (visibleItems.length === 0) return;
                
                const scrollLeft = filmstrip.scrollLeft;
                const centerPoint = scrollLeft + (filmstrip.clientWidth / 2);
                
                let closestIndex = 0;
                let minDistance = Infinity;
                
                visibleItems.forEach((item, index) => {
                    const itemCenter = item.offsetLeft + (item.offsetWidth / 2);
                    const distance = Math.abs(centerPoint - itemCenter);
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closestIndex = index;
                    }
                });
                
                if (closestIndex !== activeThumbnailIndex) {
                    updateActiveThumbnail(closestIndex);
                }
            }
            
            // Listen for filmstrip scroll to update active thumbnail
            const filmstrip = document.getElementById('galleryFilmstrip');
            let thumbnailUpdateTimeout;
            filmstrip.addEventListener('scroll', () => {
                clearTimeout(thumbnailUpdateTimeout);
                thumbnailUpdateTimeout = setTimeout(updateThumbnailFromFilmstrip, 100);
            });
            
            // Setup ResizeObserver for sidebar changes
            const leftSidebar = document.getElementById('leftSidebar');
            const rightSidebar = document.getElementById('rightSidebar');
            
            if (leftSidebar && rightSidebar) {
                const resizeObserver = new ResizeObserver(() => {
                    updateFooterWidth();
                });
                resizeObserver.observe(leftSidebar);
                resizeObserver.observe(rightSidebar);
            }
            
            // Initial footer width setup
            updateFooterWidth();
            
            // Update footer width on window resize
            window.addEventListener('resize', updateFooterWidth);
        }

        // Initialize on load
        init();
    </script>
</body>
</html>